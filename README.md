# BT Analysis

The goal here is to:

-   Extract the full lengths cds
    -   Applying this to both the Crickmore database as well as the Patric data seems to make the most sense going forward - things will just be easier.
-   Check to see if there Patric sequences are full length CDS when compared to
    the Crickmore database. This will be done using blast at the nt/prot level.
    -   If yes then proceed as normal.
    -   If no then try to build out the assembly for each contig.
-   Create a tree showing divergence with the nucleotide sequences of each
    Patric cry protein amongst those registered in the Crickmore db.
-   Analyze the protein domains
    -   Need more details about this analysis

## Get Full Length CDS

checking the size of the crickmore sequences I pulled
the shortest was 23bp (wtf) so I think 230bp will be a reasonable cutoff

```shell
get-len.pl data/crickmore/cry-proteins.cds.fasta | cut -f2 | sort | uniq -c |  perl -pe 's/^ +//g' | sort -bh -k 2 -t ' ' | head                                                                                                                                       ⏎
1 23
1 99
1 234
1 237
1 302
1 328
5 357
4 369
1 378
1 393
```

To get the ORFS from the crickmore database to make things clearer when aligning

```shell
getorf -minsize 230 -find 3 -noreverse -sequence data/crickmore/cry-proteins.cds.fasta -outseq data/crickmore/cry-proteins.cds.getorf.fasta
```

After extracting the cds I checked the size of the files. It seems like we can be a bit more stringent with this but I doubt that this will have much of an impact when running blast assuming we set the filters accordingly

```shell
grep -c '>' data/crickmore/cry-proteins.cds.*                                                                                                                                                                                                           ⏎
data/crickmore/cry-proteins.cds.fasta:806
data/crickmore/cry-proteins.cds.getorf.fasta:864
```

Make a blast db

```shell
makeblastdb -dbtype nucl -in data/crickmore/cry-proteins.cds.getorf.fasta
```

Now extract the orfs from the Patric assembly

```shell
get-len.pl data/patric/a1-d12.allseqs.cds.fasta | cut -f2 | sort | uniq -c |  perl -pe 's/^ +//g' | sort -bh -k 2 -t ' ' | head
4 63
1 66
1 69
2 75
1 78
1 87
1 81
5 90
2 93
7 96
```

The shortest sequence from Patric in 63bp so not sure if running `getorf` will be a good move since we might wipe some of the data, but worst case scenario we just omit this step. This analysis will at least catch the low hanging fruit.
```shell
getorf -minsize 230 -noreverse -find 3 -sequence data/patric/a1-d12.allseqs.cds.fasta -outseq data/patric/a1-d12.allseqs.cds.getorf.fasta
grep -c '>' data/patric/a1-d12.allseqs.cds*                                                                            
data/patric/a1-d12.allseqs.cds.fasta:6707
data/patric/a1-d12.allseqs.cds.getorf.fasta:5485
```
```
91061.11.peg.190_1      JN415764.1_4    33.333  186     124     0       1117    1674    1       558     6.51e-31        129
91061.11.peg.190_1      JN415764.1_4    50.000  62      31      0       1415    1230    299     114     1.46e-09        58.8
91061.11.peg.200_1      JN415764.1_4    26.866  201     147     0       688     1290    25      627     1.95e-25        111
91061.11.peg.710_1      BAA19948.1_1    27.273  66      48      0       146     343     2786    2983    2.23e-05        42.3
91061.11.peg.787_1      JN415764.1_4    29.801  151     106     0       1270    1722    178     630     3.41e-17        84.1
91061.11.peg.787_1      JN415764.1_4    41.176  51      30      0       1356    1204    264     112     5.21e-06        38.2
91061.11.peg.787_1      JN415764.1_4    27.778  54      39      0       1572    1411    501     340     5.21e-06        26.7
91061.11.peg.787_1      JN415764.1_4    41.379  58      34      0       1451    1278    359     186     4.38e-05        34.5
91061.11.peg.787_1      JN415764.1_4    73.333  15      4       0       1261    1217    169     125     4.38e-05        27.2
91061.11.peg.1685_1     JN415764.1_4    31.757  148     101     0       1537    1980    184     627     1.13e-21        84.1
91061.11.peg.1685_1     JN415764.1_4    41.026  39      23      0       1354    1470    1       117     1.13e-21        34.4
91061.11.peg.1685_1     JN415764.1_4    50.000  90      45      0       1691    1422    338     69      1.42e-15        79.0
91061.11.peg.1685_1     JN415764.1_4    46.341  41      22      0       1455    1577    102     224     2.30e-09        42.3
91061.11.peg.1685_1     JN415764.1_4    21.212  99      78      0       1657    1953    199     495     2.30e-09        34.4
91061.11.peg.1986_1     KC156695.1_2    25.610  82      61      0       252     7       3700    3455    2.29e-05        43.2
91061.11.peg.2151_1     AAM93496.1_1    23.810  84      64      0       1990    2241    1115    1366    9.57e-06        29.3
91061.11.peg.2151_1     AAM93496.1_1    20.769  130     103     0       1810    2199    1115    1504    3.02e-05        29.8
91061.11.peg.2169_1     JN415764.1_1    87.013  77      10      0       181     411     1       231     2.59e-40        159
91061.11.peg.2169_1     JN415764.1_1    83.929  56      9       0       411     244     231     64      3.80e-34        111
91061.11.peg.2169_1     JN415764.1_1    79.167  24      5       0       265     194     85      14      3.80e-34        46.0
91061.11.peg.2169_1     JN415764.1_1    79.452  73      15      0       192     410     12      230     3.04e-30        125
91061.11.peg.2169_1     JN415764.1_1    81.818  33      6       0       410     312     230     132     8.67e-27        72.5
91061.11.peg.2169_1     JN415764.1_1    89.655  29      3       0       272     186     92      6       8.67e-27        60.2
91061.11.peg.2169_1     JN415764.1_1    82.051  39      7       0       293     409     113     229     8.25e-21        77.6
91061.11.peg.2169_1     JN415764.1_1    76.190  21      5       0       191     253     11      73      8.25e-21        35.0
91061.11.peg.2169_1     JN415764.1_1    83.871  31      5       0       409     317     229     137     1.27e-11        63.8
91061.11.peg.2398_1     JN415764.1_4    49.275  69      35      0       1703    1497    350     144     2.07e-09        54.7
91061.11.peg.2398_1     JN415764.1_4    37.931  29      18      0       1827    1741    453     367     2.07e-09        22.1
91061.11.peg.2398_1     JN415764.1_4    31.111  90      62      0       1537    1806    184     453     3.62e-08        54.4
91061.11.peg.2492_1     AAS93798.1_1    32.836  67      45      0       1994    2194    1578    1778    1.19e-05        46.4
91061.11.peg.2648_1     JN415764.1_3    29.091  165     117     0       844     1338    445     939     2.08e-22        101
91061.11.peg.3069_1     JN415764.1_4    51.163  86      42      0       883     1140    1       258     8.05e-25        99.1
91061.11.peg.3069_1     JN415764.1_4    35.556  45      29      0       1330    1464    364     498     8.05e-25        32.7
91061.11.peg.3069_1     JN415764.1_4    52.727  55      26      0       1115    951     233     69      1.82e-10        52.8
91061.11.peg.3069_1     JN415764.1_4    38.462  26      16      0       1398    1321    432     355     1.82e-10        30.4
91061.11.peg.3069_1     JN415764.1_4    37.500  56      35      0       1104    937     222     55      1.34e-06        43.2
91061.11.peg.3069_1     JN415764.1_4    42.857  42      24      0       1460    1335    494     369     1.34e-06        26.7
91061.11.peg.3007_1     JN415764.1_4    54.878  82      37      0       1327    1572    16      261     5.65e-20        93.6
91061.11.peg.3007_1     JN415764.1_4    57.692  52      22      0       1553    1398    242     87      2.07e-08        55.1
91061.11.peg.3031_1     JN415764.1_4    52.593  135     64      0       1060    1464    1       405     1.02e-38        155
91061.11.peg.3031_1     JN415764.1_4    39.583  96      58      0       1386    1099    327     40      1.73e-21        80.3
91061.11.peg.3031_1     JN415764.1_4    40.000  30      18      0       1515    1426    456     367     1.73e-21        37.3
91061.11.peg.3031_1     JN415764.1_4    56.364  55      24      0       1238    1074    179     15      2.42e-16        57.0
91061.11.peg.3031_1     JN415764.1_4    33.058  121     81      0       1691    1329    632     270     2.42e-16        43.2
91061.11.peg.3032_1     JN415764.1_4    50.365  137     68      0       1030    1440    1       411     1.50e-40        161
91061.11.peg.3032_1     JN415764.1_4    57.143  56      24      0       1208    1041    179     12      1.50e-10        62.0
91061.11.peg.3032_1     JN415764.1_4    31.034  116     80      0       1440    1093    411     64      2.27e-08        54.2
91061.11.peg.3032_1     JN415764.1_4    60.000  10      4       0       774     745     51      22      2.27e-08        22.1
91061.11.peg.3185_1     GQ144333.1_4    40.385  52      31      0       28      183     127     282     2.77e-08        51.0
91061.11.peg.3186_1     GQ144333.1_3    41.975  81      47      0       19      261     10      252     2.37e-21        84.9
91061.11.peg.3186_1     GQ144333.1_3    72.727  11      3       0       259     291     243     275     2.37e-21        27.6
91061.11.peg.3171_1     GQ144333.1_3    41.975  81      47      0       19      261     10      252     3.27e-24        84.5
91061.11.peg.3171_1     GQ144333.1_3    45.455  33      18      0       259     357     243     341     3.27e-24        40.9
91061.11.peg.3288_1     JN415764.1_4    38.462  143     88      0       385     813     25      453     8.95e-21        95.1
91061.11.peg.3288_1     JN415764.1_4    43.564  101     57      0       692     390     332     30      1.92e-13        70.7
91061.11.peg.3347_1     D86064.1_2      33.333  63      42      0       1       189     1       189     1.79e-09        55.1
91061.11.peg.3383_1     AAA22358.1_1    32.432  111     75      0       637     969     781     1113    9.64e-27        79.7
91061.11.peg.3383_1     AAA22358.1_1    40.476  42      25      0       55      180     127     252     9.64e-27        47.7
91061.11.peg.3606_1     AGM16381.1_1    34.783  46      30      0       381     244     1345    1208    3.75e-08        40.9
91061.11.peg.3606_1     AGM16381.1_1    34.286  35      23      0       585     481     1564    1460    3.75e-08        28.6
91061.11.peg.3606_1     AGM16381.1_1    43.478  23      13      0       141     73      280     212     3.75e-08        27.6
91061.11.peg.3619_1     AAM46849.1_1    27.928  111     80      0       637     969     757     1089    9.05e-28        81.5
91061.11.peg.3619_1     AAM46849.1_1    37.838  37      23      0       178     288     235     345     9.05e-28        38.5
91061.11.peg.3627_1     GQ144333.1_4    67.742  93      30      0       1       279     1       279     2.49e-40        157
91061.11.peg.3627_1     GQ144333.1_4    52.688  93      44      0       279     1       279     1       1.22e-27        115
91061.11.peg.3627_1     GQ144333.1_4    54.348  92      42      0       3       278     3       278     9.62e-25        105
91061.11.peg.3627_1     GQ144333.1_4    59.783  92      37      0       278     3       278     3       2.49e-24        104
91061.11.peg.3627_1     GQ144333.1_4    55.952  84      37      0       23      274     23      274     4.02e-22        97.3
91061.11.peg.3627_1     GQ144333.1_4    54.945  91      41      0       274     2       274     2       7.00e-21        93.2
91061.11.peg.3631_1     ASY04853.1_1    43.750  64      36      0       460     651     478     669     2.19e-16        69.4
91061.11.peg.3631_1     ASY04853.1_1    50.000  28      14      0       757     840     799     882     2.19e-16        32.8
91061.11.peg.3632_1     GQ144333.1_3    82.143  84      15      0       1       252     1       252     3.43e-60        172
91061.11.peg.3632_1     GQ144333.1_3    84.848  33      5       0       250     348     243     341     3.43e-60        73.9
91061.11.peg.3632_1     GQ144333.1_3    81.928  83      15      0       254     6       254     6       1.89e-44        136
91061.11.peg.3632_1     GQ144333.1_3    71.875  32      9       0       348     253     341     246     1.89e-44        57.4
91061.11.peg.3632_1     GQ144333.1_3    67.949  78      25      0       6       239     6       239     2.40e-40        124
91061.11.peg.3632_1     GQ144333.1_3    54.762  42      19      0       224     349     217     342     2.40e-40        55.6
91061.11.peg.3632_1     GQ144333.1_3    63.415  82      30      0       246     1       246     1       4.05e-39        124
91061.11.peg.3632_1     GQ144333.1_3    64.706  34      12      0       349     248     342     241     4.05e-39        51.9
91061.11.peg.3632_1     GQ144333.1_3    67.089  79      26      0       241     5       241     5       9.48e-35        110
91061.11.peg.3632_1     GQ144333.1_3    81.818  33      6       0       347     249     340     242     9.48e-35        51.5
91061.11.peg.3632_1     GQ144333.1_3    62.821  78      29      0       5       238     5       238     2.14e-24        99.1
91061.11.peg.3632_1     GQ144333.1_3    63.636  33      12      0       249     347     242     340     2.14e-24        27.6
91061.11.peg.3690_1     CAA39609.1_1    40.741  27      16      0       198     118     1369    1289    3.94e-05        40.5
91061.11.peg.3683_1     GQ144333.1_3    39.216  51      31      0       1       153     100     252     2.72e-14        51.9
91061.11.peg.3683_1     GQ144333.1_3    39.394  33      20      0       151     249     243     341     2.72e-14        39.1
91061.11.peg.3724_1     JN226105.1_1    37.903  124     77      0       991     1362    670     1041    7.11e-27        115
91061.11.peg.3731_1     HM068615.1_2    79.268  82      17      0       163     408     123     368     1.45e-41        162
91061.11.peg.3731_1     HM068615.1_2    83.333  66      11      0       209     406     169     366     1.54e-27        116
91061.11.peg.3731_1     HM068615.1_2    87.500  64      8       0       406     215     366     175     5.07e-26        111
91061.11.peg.3731_1     HM068615.1_2    100.000 17      0       0       407     357     367     317     1.62e-25        41.4
91061.11.peg.3731_1     HM068615.1_2    94.118  17      1       0       408     358     368     318     5.06e-24        38.6
91061.11.peg.3731_1     HM068615.1_2    85.938  64      9       0       216     407     176     367     2.29e-20        92.3
91061.11.peg.3734_1     ASY04853.1_1    33.333  66      44      0       529     726     478     675     7.39e-07        49.0
91061.11.peg.3770_1     JN415764.1_4    26.351  148     109     0       1483    1926    184     627     9.20e-19        70.5
91061.11.peg.3770_1     JN415764.1_4    46.154  39      21      0       1300    1416    1       117     9.20e-19        38.1
91061.11.peg.3770_1     JN415764.1_4    49.474  95      48      0       1595    1311    296     12      1.90e-07        51.9
91061.11.peg.3783_1     GQ144333.1_3    42.000  50      29      0       1       150     103     252     1.61e-12        56.1
91061.11.peg.3783_1     GQ144333.1_3    61.111  18      7       0       148     201     243     296     1.61e-12        29.5
91061.11.peg.3789_1     CAA30312.1_1    76.471  306     72      0       2485    3402    2485    3402    0.0     585
91061.11.peg.3789_1     CAA30312.1_1    72.947  207     56      0       1858    2478    1861    2481    0.0     358
91061.11.peg.3792_1     BAE86999.1_1    71.739  414     117     0       472     1713    487     1728    0.0     719
91061.11.peg.3792_1     BAE86999.1_1    54.400  250     114     0       1685    936     1700    951     6.16e-131       241
91061.11.peg.4018_1     GQ144333.1_3    43.137  51      29      0       1       153     100     252     1.81e-12        57.4
91061.11.peg.4018_1     GQ144333.1_3    55.556  18      8       0       151     204     243     296     1.81e-12        27.6
91061.11.peg.4021_1     KJ123823.1_2    53.642  151     70      0       97      549     61      513     5.46e-58        217
91061.11.peg.4021_1     KJ123823.1_2    46.309  149     80      0       545     99      509     63      6.37e-24        104
91061.11.peg.4065_1     GQ144333.1_4    79.412  102     21      0       1       306     1       306     1.29e-53        202
91061.11.peg.4065_1     GQ144333.1_4    70.297  101     30      0       305     3       305     3       1.40e-38        152
91061.11.peg.4065_1     GQ144333.1_4    68.627  51      16      0       3       155     3       155     4.95e-30        79.9
91061.11.peg.4065_1     GQ144333.1_4    61.905  42      16      0       180     305     180     305     4.95e-30        62.0
91061.11.peg.4065_1     GQ144333.1_4    58.824  102     42      0       306     1       306     1       6.34e-29        120
91061.11.peg.4065_1     GQ144333.1_4    61.905  42      16      0       179     304     179     304     6.10e-18        57.9
91061.11.peg.4065_1     GQ144333.1_4    72.414  29      8       0       2       88      2       88      6.10e-18        43.2
91061.11.peg.4065_1     GQ144333.1_4    59.524  42      17      0       304     179     304     179     1.66e-15        60.6
91061.11.peg.4065_1     GQ144333.1_4    53.846  26      12      0       145     68      145     68      1.66e-15        32.2
91061.11.peg.4097_1     BAD08532.1_1    65.909  44      15      0       178     309     1291    1422    3.96e-46        70.7
91061.11.peg.4097_1     BAD08532.1_1    64.516  31      11      0       352     444     1483    1575    3.96e-46        53.3
91061.11.peg.190_1      JN415764.1_4    33.333  186     124     0       1117    1674    1       558     6.51e-31        129
91061.11.peg.190_1      JN415764.1_4    50.000  62      31      0       1415    1230    299     114     1.46e-09        58.8
91061.11.peg.190_1      JN415764.1_4    33.333  186     124     0       1117    1674    1       558     6.51e-31        129
91061.11.peg.190_1      JN415764.1_4    50.000  62      31      0       1415    1230    299     114     1.46e-09        58.8
91061.11.peg.200_1      JN415764.1_4    26.866  201     147     0       688     1290    25      627     1.95e-25        111
91061.11.peg.710_1      BAA19948.1_1    27.273  66      48      0       146     343     2786    2983    2.23e-05        42.3
91061.11.peg.787_1      JN415764.1_4    29.801  151     106     0       1270    1722    178     630     3.41e-17        84.1
91061.11.peg.787_1      JN415764.1_4    41.176  51      30      0       1356    1204    264     112     5.21e-06        38.2
91061.11.peg.787_1      JN415764.1_4    27.778  54      39      0       1572    1411    501     340     5.21e-06        26.7
91061.11.peg.787_1      JN415764.1_4    41.379  58      34      0       1451    1278    359     186     4.38e-05        34.5
91061.11.peg.787_1      JN415764.1_4    73.333  15      4       0       1261    1217    169     125     4.38e-05        27.2
91061.11.peg.1685_1     JN415764.1_4    31.757  148     101     0       1537    1980    184     627     1.13e-21        84.1
91061.11.peg.1685_1     JN415764.1_4    41.026  39      23      0       1354    1470    1       117     1.13e-21        34.4
91061.11.peg.1685_1     JN415764.1_4    50.000  90      45      0       1691    1422    338     69      1.42e-15        79.0
91061.11.peg.1685_1     JN415764.1_4    46.341  41      22      0       1455    1577    102     224     2.30e-09        42.3
91061.11.peg.1685_1     JN415764.1_4    21.212  99      78      0       1657    1953    199     495     2.30e-09        34.4
91061.11.peg.1986_1     KC156695.1_2    25.610  82      61      0       252     7       3700    3455    2.29e-05        43.2
91061.11.peg.2151_1     AAM93496.1_1    23.810  84      64      0       1990    2241    1115    1366    9.57e-06        29.3
91061.11.peg.2151_1     AAM93496.1_1    20.769  130     103     0       1810    2199    1115    1504    3.02e-05        29.8
91061.11.peg.2169_1     JN415764.1_1    87.013  77      10      0       181     411     1       231     2.59e-40        159
91061.11.peg.2169_1     JN415764.1_1    83.929  56      9       0       411     244     231     64      3.80e-34        111
91061.11.peg.2169_1     JN415764.1_1    79.167  24      5       0       265     194     85      14      3.80e-34        46.0
91061.11.peg.2169_1     JN415764.1_1    79.452  73      15      0       192     410     12      230     3.04e-30        125
91061.11.peg.2169_1     JN415764.1_1    81.818  33      6       0       410     312     230     132     8.67e-27        72.5
91061.11.peg.2169_1     JN415764.1_1    89.655  29      3       0       272     186     92      6       8.67e-27        60.2
91061.11.peg.2169_1     JN415764.1_1    82.051  39      7       0       293     409     113     229     8.25e-21        77.6
91061.11.peg.2169_1     JN415764.1_1    76.190  21      5       0       191     253     11      73      8.25e-21        35.0
91061.11.peg.2169_1     JN415764.1_1    83.871  31      5       0       409     317     229     137     1.27e-11        63.8
91061.11.peg.2398_1     JN415764.1_4    49.275  69      35      0       1703    1497    350     144     2.07e-09        54.7
```

I figured tblastx would be the most ideal but the results didn't yield that different of results. So I ran a blastn:
```shell
blastn -db data/crickmore/cry-proteins.cds.getorf.fasta -query data/patric/a1-d12.allseqs.cds.getorf.fasta -max_target_seqs 1 -culling_limit 2 -evalue 0.00005 -out data/patric/a1-d12.allseqs.cds.getorf.blastn.tsv -outfmt 6 -num_threads 4
```

```
91061.11.peg.2169_1     JN415764.1_1    92.727  220     16      0       192     411     12      231     1.32e-87        318
91061.11.peg.3731_1     HM068615.1_2    93.846  195     12      0       214     408     174     368     1.55e-80        294
91061.11.peg.3789_1     FJ597622.1_1    75.641  858     195     7       2549    3402    2555    3402    1.02e-115       414
91061.11.peg.3792_1     GU446675.1_1    82.241  1937    308     22      73      1985    85      2009    0.0     1639
91061.11.peg.4331_1     EU646202.1_1    86.168  976     129     6       2578    3550    2608    3580    0.0     1050
91061.11.peg.4331_1     EU646202.1_1    98.077  52      1       0       1       52      1       52      2.04e-18        91.6
```
